---
layout: doc
title:  "Как создавать свои собственные шаблоны"
date:   2013-07-16 18:53:38
tags: templates developer
---

Если Вы умеете работать с шаблонами Cobalt, перед Вами открываются неограниченные возможности. Каждый, кто понимает эту простую концепцию, кушает бананы. Все, что он может сказать:

> WOW! Теперь я могу делать все что захочу!

Но сначала надо научиться. И это займет некоторое время. Но мы поможем Вам пройти этот путь. И даже если у Вас возникнут вопросы, на которые мы не ответили в этой статье, мы поможем Вам и ответим на любой из них на нашем [форуме поддержки](http://support.mintjoomla.com/ru).

## 1. Что такое шаблоны Cobalt?

Шаблоны Cobalt это система, позволяющая Вам устанавливать различные шаблоны вывода или стили для каждой _секции_ или _типа контента_ или _поля_.

#### Настройки шаблонов в Типе контента

![](http://serhioromano.s3.amazonaws.com/mintjoomla/tutorial-customtmpl/typetmpl.png)

#### Настройки шаблонов в Разделе

![](http://serhioromano.s3.amazonaws.com/mintjoomla/tutorial-customtmpl/sectiontmpl.png)

При таком подходе каждый раздел, статья, комментарий или другой отображаемый блок может выглядеть по разному. В то же время, все изменения сохраняются при обновление самого Cobalt.
Маленький значок шестеренки ![](http://www.mintjoomla.com/media/mint/icons/16/gear.png) позволяет Вам устанавливать параметры шаблонов. Также у Вас есть возможность создавать собственные шаблоны.

## 2. Требования

Для управления шаблонами Вам не обязательно быть экспертом.

- Знание CSS/HTML - **Любой уровень** (но естественно чем больше вы знаете тем больше вы сможите)
- Знание [Twitter Bootstrap](http://twitter.github.io/bootstrap/index.html). Это набор стилей которые использует сегодня Joomla серии 3. Вам будет гораздо легче верстать если вы изучите возможности этого фреймворка. Это не должно зянять больше 20 минут.
- Знание PHP - **Начальный уровень** (некоторые приемы программирования требуют более глубоких знаний, но для базового редактирования шаблонов начального уровня более чем достаточно). Под начальным я понимают что вы хотя бы можите отличить кусок PHP кода от HTML.

  То есть сможите понять смысл вот такого выражения

      <h2><?php echo $item->title; ?></h2>

  Это выражение просто выводит на экран заголовок статьи. Если это не трудно для Вас, можете продолжать чтение.

## 3. Создание копии шаблона

Разработку любого шаблона необходимо начинать с создания копии уже существующего шаблона. Это очень важный шаг для сохранения изменений при следующем обновлении Cobalt. Если вы будите править существующий шаблон то рискуете потерять ваши правки так как при установке он будет опять перезаписан.

- (1) Откройте менеджер шаблонов Cobalt.
- (2) (3) Выберите шаблон, который подходит Вам больше всего. Обычно есть только один _default_ шаблон по умолчанию, однако для списка статей и для индекса категории есть несколько шаблонов. Если Вам необходим табличный шаблон, копируйте _deafult_. Если Вам нужен шаблон, больше похожий на блог, копируйте _simple_list_.
- (4) Нажмите кнопку _Копировать/Переименовать_ на панели управления.
- (5) (6) Введите новое имя шаблона и нажмите кнопку _Копировать_.

  <div class="alert">Помните, новое имя шаблона будет частью файлового имени шаблона. Поэтому используйте только символы `a-z` и `_`.  Используйте только маленькие буквы.</div>

  После обновления страницы Вы увидите новый шаблон в списке.
- (7) Если Вы копируете шаблон из _Список статей_, также необходимо изменить имя шаблона. Потому что это имя в дальнейшем может быть использовано в переключателе шаблонов на frontend, если Вы используете больше 1 шаблона для раздела. Введите имя в поле _Изменить метку_ и нажмите кнопку _Изменить метку_.

![](http://serhioromano.s3.amazonaws.com/mintjoomla/tutorial-customtmpl/copytmpl.png)

## 4. Где расположены файлы шаблонов

Ниже описаны пути, где будут сохранены Ваши новые шаблоны. * - имя, которые Вы дадите шаблону при его копировании.

- Список статей - `/components/com_cobalt/views/records/tmpl/default_list_*`
- Индекс категории - `/components/com_cobalt/views/records/tmpl/default_cindex_*`
- Основная разметка - `/components/com_cobalt/views/records/tmpl/default_markup_*`
- Полный вид статьи - `/components/com_cobalt/views/record/tmpl/default_record_*`
- Комментарии - `/components/com_cobalt/views/record/tmpl/default_comments_*`
- Форма - `/components/com_cobalt/views/form/tmpl/default_form_*`
- Выбор категории - `/components/com_cobalt/views/form/tmpl/default_category_*`

## 5. Файлы шаблонов

Каждый шаблон может иметь эти файлы. Возьмем для примера шаблон `default_record_default.php`.
Вы можете создать следующие файлы

- `default_record_default` - папка, в которой хранятся все дополнительные файлы Вашего шаблона. Вы должны использовать эту папку, если хотите, чтобы все необходимые файлы были скопированы упаковщиком Cobalt.
- `default_record_default.php` - сам файл шаблона.
- `default_record_default.css` - содержит таблицы стилей CSS шаблона. Подключается автоматически.
- `default_record_default.js` - содержит java скрипты. Подключается автоматически.
- `default_record_default.png` - маленькая картинка шаблона для предварительного просмотра в менеджере шаблонов. Как правило, размер изображения не превышает 300x300 px. Но Вы можете сделать его больше.
- `default_record_default.xml` - содержит информацию об авторе и параметрах шаблона. Как использовать параметры, я покажу позже.

## 6. Настройка шаблонов

Как правило, самые важные вопросы бывают про шаблоны Статьи и Списка статей где нам необходимо отображить данные полей статьи.

<div class="alert alert-info">Нет лучшего способа что-то узнать, как только посмотреть код других людей. Поэтому пожалуйста, посмотрите код шаблонов, чтобы узнать, как это используется и какие переменные доступны.</div>

### Объект Запись (Record)

В шаблоне списка статей или полного вида статьи Вы увидите объект `$item`, который содержит в себе Запись (record).

Объект `$item` содержит как основные свойства Записи, например ctime (время создания), rating (рейтинг), hits (просмотры), user_id (id пользователя), так и поля. Доступ к основным свойствам Записи можно получить, как показано ниже:

	Hits: <?php echo $item->hits; ?>
	
> #### Q: Как посмотреть список всех доступных свойств объекта Запись (record)?
> Для просмотра всех свойств объекта `$item` можно просто добавить в нужных местах шаблона следующее выражение
	
>     var_dump(get_object_vars($item));

> #### Q: Как получить URL записи?

> Если вы хотите получить URL текущей записи. Для URL объекта `$item` это работает так

>     <?php echo JRoute::_($item->url);?>

> Если Вам необходим URL другой записи и Вы имеете только ID

>     <?php echo JRoute::_(Url::record($record_id));?>

### Поля Записи

Теперь объект `$item` содержит несколько массивов полей, организованных различными способами.

- `$item->fields_by_id` - массив полей записи, где ID поля является ключом массива.
- `$item->fields_by_key` - массив полей записи, где ключ (key) поля является ключом массива. Пожалуйста, прочитайте что это такое в FAQ в конце этого раздела статьи.
- `$item->fields_by_group` - многоуровневый массив полей записи, где первый уровень является группой полей, а на втором уровне расположены сами поля. Поля не сгруппированые в группы находятся в индексе `0`.

Существует два варианта показать результаты Ваших полей. И очень просто принять решение, какой из них использовать. Если Вы создаете шаблон который предположительно будет отображать разные типы контента, **необходимо** использовать доступ к полю через `fields_by_key`. Если Вы создаете шаблон для одного типа контента, **можно** использовать метод `fields_by_id`.

	<?php if(isset($item->fields_by_id[12])): ?>
    	<span class="field-year">
        	<?php echo $item->fields_by_id[12]->result; ?>
	    </span>
	<?php endif; ?>

Если Вы хотите вызвать поле по ключу, сначала необходимо получить ключ по ID поля а потом уже вызвать поле по ключу.

	<?php $key = $this->fields_keys_by_id[12];?>
	<?php if(isset($item->fields_by_key[$key])): ?>
    	<span class="field-year">
        	<?php echo $item->fields_by_key[$key]->result; ?>
	    </span>
	<?php endif; ?>

Пример выше поддерживает шаблон с несколькими типами контента. Предположим это список статей нескольких типов и в каждом типе есть поле цена. В одном типе это ID 12 в другом 25. Этот пример покажет как то поле так и другое. Так как `$this->fields_keys_by_id[12]` и `$this->fields_keys_by_id[25]` вернут совершенно одиноковый ключ.

> #### Q: Как узнать идентификатор (ID) поля?

> Вы можете найти идентификатор поля в списке полей **(2)**

> ![](http://serhioromano.s3.amazonaws.com/mintjoomla/tutorial-customtmpl/typeandid.png)

> #### Q: Что такое ключ (key) поля.

> _Ключ поля_ теперь есть часть поддержки нескольких типов контента в шаблонах. Вам не нужно создавать этот ключ, я просто хочу объяснить нашу концепцию. Ключ поля образуется как результат MD5 типа поля и его метки.

>     $field_key = 'k'.md5($field->label.'-'.$field->field_type);

> Пусть метка поля будет _Year_ и тип поля будет _digits_. Тогда

>     $field_key = 'k'.md5('Year-digits');

> Тогда при вызове поля по ключу (field by key), независимо от его типа, если это было поле _Year_ типа _digits_, оно будет показано в Вашем шаблоне.

> Вы можете найти ключ поля в столбце `key` списка полей `jos_js_res_fields` **(3)**.

> ![](http://serhioromano.s3.amazonaws.com/mintjoomla/tutorial-customtmpl/typeandid.png)

> #### Q: Результат поля содержит HTML код. Как получить строку текста?

> Самый просто способ получить текст без HTML кода.

>     echo strip_tags($item->fields_by_id[12]->result);

> #### Q: Как получить данные поля если поле недоступно?

> Предположим есть поле которое нельзя показывать в списке но вы хотите получить данные этого поля. У объекта `$item` есть свойство `fields`. Оно является массивом данных с индексом данных полей по айди поля. Вот такой код покажет вам читсные данные поля не обработаные и не преобразованые в HTML.
 
>     var_dump($item->fields[12]);

> #### Q: Как я могу посмотреть все доступные свойства объекта Поле (field object)?

> Вы можете использовать этот метод для получения списка свойств объекта.

>     var_dump(get_object_vars($item->fields_by_id[12]));

### Объект Поле (Field)

Каждый `$item->fields_by_key[$key]` или `$item->fields_by_id[12]` является объектом Поле (field) и содержит значительно больше параметров, чем `->result`.

Некоторые из них очень полезны. Например, в таблице Вы хотите все поля типа _digits_ выровнять по правому краю.

	<td<?php echo ($field->type == 'digits' ? ' align="right" ' : NULL ) ?>>
    	<?php echo $field->result;?>
	</td>

Или `$item->fields_by_id[12]->params` содержит в себе все параметры, которые Вы установили при создании поля. Например класс, установленный в параметрах поля.

	<span class="my-class <?php echo $item->fields_by_id[12]->params->get('core.field_class')?>">
	    <?php echo $item->fields_by_id[12]->result;?>
	</span>

Или `$field->value` содержить не обработанные данные поля. 

> #### Q: Какие типы полей доступны и как я могу узнать тип поля?

> Вы можете найти тип поля в списке полей **(1)**

> ![](http://serhioromano.s3.amazonaws.com/mintjoomla/tutorial-customtmpl/typeandid.png)

### Шаблоны поля (Field Templates)

Теперь существует замечательная и уникальная возможность изменить существующий или добавить новый _output (для вывода)_, _input (для ввода)_ или _filter (для фильтра)_ шаблон для каждого поля. Каждое поле имеет параметры для установки шаблона _output_, _filter_ или _input_. И эта замечательная и уникальная возможность дает вам полный контроль над тем, как будет выглядеть каждое поле.

![](http://serhioromano.s3.amazonaws.com/mintjoomla/tutorial-customtmpl/fieldstmpls.png)

Как говорилось выше, существует 3 типа шаблонов _output_, _filter_ и _input_. И все они поддерживают технологию переопределения шаблонов Joomla.

#### _Вывод (Output)_

Эти шаблоны используются для вывода поля в списке статей или в полном виде статьи.

- расположение - `com_cobalt/fields/[field_name]/tmpl/output/`
- переопределение Joomla - `templates/[template_name]/html/com_cobalt/fields/[field_name]/output/`

#### _Ввод (Input)_

Эти шаблоны используются в форме подачи статьи и при выводе элементов формы.

- расположение - `com_cobalt/fields/[field_name]/tmpl/input/`
- переопределение Joomla - `templates/[template_name]/html/com_cobalt/fields/[field_name]/input/`

#### _Фильтр (Filter)_

Эти шаблоны используются в форме расширенного поиска или в модуле фильтра.

- расположение - `com_cobalt/fields/[field_name]/tmpl/filter/`
- переопределение Joomla - `templates/[template_name]/html/com_cobalt/fields/[field_name]/filter/`

Просто скопируйте один из шаблонов с другим именем, модифицируйте и выберите этот шаблон в параметрах поля. Или создайте одноименный файл в папке переопределения шаблонов Joomla.

### Поля формы

В основном, поля на форме есть те же объекты Поле (field object). Переменная `->result` содержит элемент формы.
Существует 2 главных хранилища полей.

- `$this->fields` - массив полей, где ID поля является ключом массива.

    	echo $this->fields[12]->label.': '.$this->fields[12]->result;
- `$this->sorted_fields` - многоуровневый массив, где первый элемент является ID группы полей (0 для несгруппированных полей), а на втором уровне расположены сами поля и ключ поля является ключом массива.


  <div class="alert">Пожалуйста, изучите шаблон формы default. Он очень понятен. Вы найдете в нем много полезной информации.</div>

### Отладка

Иногда Вам необходимо сделать что-то необычное, и Вы должны знать реальные значения поля.

	echo htmlspecialchars($item->fields_by_id[12]->result);

Этот фрагмент кода поможет Вам увидеть скрытые символы и получить идею, как это обработать.

## 7. Параметры шаблонов

Для наиболее эффективного создания шаблонов и управления ими Вы можете использовать параметры шаблонов. Вы можете добавить свои параметры, которые будут влиять на стиль шаблона, позицию поля или еще что-нибудь по Вашему желанию.

В `default_record_default.xml` - в любом XML файле шаблона Вы найдете 2 группы параметров `<fields>`. Это _tmpl_params_ и _tmpl_core_. 

Например


	<fields name="tmpl_params">
	    <fieldset name="general">
	        <field name="max_width" type="text" size="6" default="150" label="CSELCTMAXW" description="CSELWDESCR" />
	            <field name="cat_ordering" type="list" label="CORDERING"  default="c.lft ASC">
	            <option value="c.lft ASC">CORDERING</option>
	            <option value="c.title ASC">CORDERNAMEASC</option>
	            <option value="c.title DESC">CORDERNAMEDESC</option>
	        </field>
	        <field name="cat_descr" type="list" default="0" label="CTOOTIPDESCR" description="">
	            <option value="0">CNO</option>
	            <option value="before">CTOOLTIPBEFOR</option>
	            <option value="after">CTOOLTIOPAFTER</option>
	            <option value="full">CTOOLTIPFULL</option>
	        </field>
	    </fieldset>
	</fields>
	<fields name="tmpl_core">
	    <fieldset name="general2">
	        <field name="category_label" type="radio" label="CSHOWLABEL"  default="1">
	            <option value="0">CNO</option>
	            <option value="1">CYES</option>
	        </field>
    	</fieldset>
	</fields>


<div class="alert alert-info">Вы можете добавлять свои параметры только в группу _tmpl_params_. Не удаляйте группу _tmpl_core_, т.к. она может быть использована внутри Cobalt.</div>

Вы можете добавлять любое количество параметров в группу `<fields name="tmpl_params">`. На самом деле это даже хорошо, потому что чем лучше организованы Ваши параметры, тем легче это использовать. Группируйте парамтеры в группы `<fieldset>` для более удобного использования.

Вы также можете добавить атрибуты `description` и `label`, для `<fieldset>` например


	<fieldset name="general" label="main Parameters" description="Do not miss required parameters">
	    // fields go her ...
	</fieldset>

После добавления параметров в XML-файл шаблона, Вы имеете к ним доступ в настройках шаблона.

В каждом шаблоне параметры передаются по-разному. Я знаю, что это не совсем хорошо, но это необходимо. Чтобы узнать, как использовать параметры шаблона, смотрите начало PHP-файла шаблона. В каждом шаблоне Cobalt мы инициализируем переменную `$params`. Что-то вроде этого

	$params = $this->tmpl_params;

Или этого

	$params = $this->tmpl_params['list'];

Но это всегда `$params`. Таким образом Вы можете узнать, как инициализируется объект `$params` Вашего шаблона. Не удаляйте эту строку кода.

Теперь Вы можете это использовать, например

	<?php if($params->get('tmpl_params.item_icon_title')): ?>
	    <?php echo JHTML::image($url);?>
	<?php endif; ?>

Здесь `tmpl_params` в `tmpl_params.item_icon_title` есть имя группы параметров и `item_icon_title` есть имя поля

	<field name="item_icon_title" type="radio" label="Show icon title"  default="1">
	    <option value="0">CNO</option>
	    <option value="1">CYES</option>
	</field>

## 8. Настройка полей в Параметрах

Это отличная технология для управления, стилизации или позиционирования полей.
Например, есть поле Price. И Вы хотите показать его в определенном месте в особом стиле.

- Добавьте параметр

	  <fields name="tmpl_params">
	  <fieldset name="name1" label="Position Fields"
	          description="Set fields to be positioned">
	          <field name="field_price" type="meresourcesfields" label="Where is the price?" />
	      </fieldset>
	  </fields>

  <div class="alert">Если какой-либо из параметров ссылается на поле, имя этого параметра должно начинаться с `field_*` для дальнейшей корректной упаковки и распаковки упаковщиком.</div>

  Если Вы хотите, чтобы в списке были показаны поля только некоторого типа, используйте атрибут `filters="'text', ' textarea', 'html'"`. Этим Вы ограничите типы показываемых полей.

  Чтобы поле имело множественный выбор, добавьте `size="15"` и `multiple="true"`

- В шаблоне используйте что-нибудь типа этого

      <?php $key = $this->fields_keys_by_id[$params->get('tmpl_params.field_price')];?>
      <?php if(isset($item->fields_by_key[$key])): ?>
          <span class="field-price">
              <?php echo $item->fields_by_key[$key]->result; ?>
          </span>
      <?php endif; ?>

> #### Q: Как исключить определенное поле из массива полей после его вывода?

> После того, как Вы вывели это поле, Вы можете исключить его из массива полей.

>      <?php $key = $this->fields_keys_by_id[$params->get('tmpl_params.field_price')];?>
>      <?php if(isset($item->fields_by_key[$key])): ?>
>          <span class="field-price">
>              <?php echo $item->fields_by_key[$key]->result; ?>
>              <?php unset($item->fields_by_key[$key]) ?>
>          </span>
>      <?php endif; ?>

> Теперь поля _field_price_ не будет в массиве.

### Создание установочного пакета

Существует 2 способа создания установочного пакета. Первый очень простой - просто упакуйте все файлы в zip-архив. Если Вы хотите упаковать несколько шаблонов, Вы можете организовать структуру вложенных папок. Но на самом деле не важно, как Вы их упаковали. Установщик на основании имени файла скопирует его в правильное место.

Такой пакет будет хорош только при установке через менеджер шаблонов.

Если Вы хотите устанавливать Ваш пакет через установщик Joomla, Вам необходимо изучить, как это делается. Это не входит в тему урока.